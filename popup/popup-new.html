<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Password Manager</title>
  <link rel="stylesheet" href="popup.css">
  <style>
    .search-box {
      padding: 16px;
      border-bottom: 1px solid var(--gray-200);
      background: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    .search-input {
      width: 100%;
      padding: 12px 16px 12px 40px;
      font-size: 14px;
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-md);
      transition: var(--transition-all);
      background: var(--gray-50);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 12px center;
    }
    .search-input:focus {
      outline: none;
      border-color: var(--primary-400);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      background: white;
    }
    .credentials-container {
      max-height: 380px;
      overflow-y: auto;
      padding: 0 16px 16px;
    }
    .credential-card {
      padding: 16px;
      border-bottom: 1px solid var(--gray-200);
      transition: var(--transition-all);
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      position: relative;
    }
    .credential-card:last-child {
      border-bottom: none;
    }
    .credential-card:hover {
      background: var(--gray-50);
      transform: translateX(4px);
    }
    .credential-card::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 3px;
      background: linear-gradient(to bottom, var(--primary-500), var(--secondary-500));
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      opacity: 0;
      transition: var(--transition-all);
    }
    .credential-card:hover::before {
      opacity: 1;
    }
    .fill-btn {
      padding: 8px 16px;
      background: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-all);
      white-space: nowrap;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }
    .fill-btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      opacity: 0;
      transition: var(--transition-all);
    }
    .fill-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(79, 70, 229, 0.3);
    }
    .fill-btn:hover::before {
      opacity: 1;
    }
    .fill-btn:active {
      transform: translateY(0);
    }
    .credential-icon {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-500) 0%, var(--secondary-500) 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      flex-shrink: 0;
      box-shadow: var(--shadow-sm);
    }
    .credential-details {
      flex: 1;
      min-width: 0;
    }
    .credential-website {
      font-size: 15px;
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .credential-website::before {
      content: "üåê";
      font-size: 14px;
    }
    .credential-username {
      font-size: 13px;
      color: var(--gray-500);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .credential-username::before {
      content: "üë§";
      font-size: 12px;
    }
    .no-results {
      text-align: center;
      padding: 50px 20px;
      color: var(--gray-500);
    }
    .loading-container {
      text-align: center;
      padding: 50px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid var(--gray-200);
      border-top: 4px solid var(--primary-500);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Improved form styling */
    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--gray-700);
      font-size: 14px;
    }
    .form-group input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--gray-200);
      border-radius: var(--radius-md);
      font-size: 15px;
      transition: var(--transition-all);
      background: var(--gray-50);
    }
    .form-group input:focus {
      outline: none;
      border-color: var(--primary-400);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      background: white;
    }
    #loginError {
      padding: 12px;
      background: #fee2e2;
      color: #dc2626;
      border-radius: var(--radius-md);
      font-size: 14px;
      margin-bottom: 16px;
      border: 1px solid #fecaca;
    }
    .spinner-inline {
      width: 16px;
      height: 16px;
      border: 2px solid var(--gray-200);
      border-top: 2px solid #ffffff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    
    /* Stats bar */
    .stats-bar {
      display: flex;
      gap: 12px;
      padding: 12px 16px;
      background: white;
      border-bottom: 1px solid var(--gray-200);
      font-size: 12px;
      color: var(--gray-600);
    }
    .stat-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
  </style>
</head>
<body>
  <!-- Not Authenticated View -->
  <div id="notAuthView" style="display: none;">
    <div class="popup-header">
      <div class="logo">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 1L3 5V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V5L12 1Z" stroke="#4f46e5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 12C13.6569 12 15 10.6569 15 9C15 7.34315 13.6569 6 12 6C10.3431 6 9 7.34315 9 9C9 10.6569 10.3431 12 12 12Z" stroke="#4f46e5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 12V16" stroke="#4f46e5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h2>Secure Password Manager</h2>
    </div>
    <div class="popup-body">
      <form id="inlineLoginForm">
        <div class="form-group">
          <label for="loginUserId">User ID</label>
          <input
            type="text"
            id="loginUserId"
            placeholder="Enter your user ID"
            autocomplete="username"
            required
          >
        </div>
        <div class="form-group">
          <label for="loginPassword">Master Password</label>
          <input
            type="password"
            id="loginPassword"
            placeholder="Enter your master password"
            autocomplete="current-password"
            required
          >
        </div>
        <div id="loginError" style="display: none;"></div>
        <button type="submit" class="btn btn-primary" id="loginSubmitBtn">
          <span id="loginBtnText">Unlock Vault</span>
          <span id="loginBtnSpinner" class="spinner-inline" style="display: none;"></span>
        </button>
      </form>
    </div>
  </div>

  <!-- Authenticated View -->
  <div id="authView" style="display: none;">
    <!-- Header -->
    <div class="popup-header">
      <div class="logo-small">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 1L3 5V11C3 16.55 6.84 21.74 12 23C17.16 21.74 21 16.55 21 11V5L12 1Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 12C13.6569 12 15 10.6569 15 9C15 7.34315 13.6569 6 12 6C10.3431 6 9 7.34315 9 9C9 10.6569 10.3431 12 12 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 12V16" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="user-info">
        <div class="user-name" id="userName">Loading...</div>
        <div class="user-role" id="userRole" style="font-size: 12px; color: rgba(255,255,255,0.9); margin-top: 2px;"></div>
      </div>
      <button id="refreshBtn" class="btn-icon" title="Refresh Credentials">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
      </button>
      <button id="logoutBtn" class="btn-icon" title="Logout">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
      </button>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
        </svg>
        <span>Secure</span>
      </div>
      <div class="stat-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M12 6v6l4 2"></path>
        </svg>
        <span>Encrypted</span>
      </div>
      <div class="stat-item">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 12H4"></path>
          <path d="M12 20l-4-4 4-4"></path>
        </svg>
        <span>Synced</span>
      </div>
    </div>

    <!-- Search Box -->
    <div class="search-box">
      <input
        type="text"
        id="searchInput"
        class="search-input"
        placeholder="Search your credentials..."
        autocomplete="off"
      >
    </div>

    <!-- Credentials List -->
    <div class="credentials-container" id="credentialsContainer">
      <div class="loading-container">
        <div class="spinner"></div>
        <p>Decrypting your credentials...</p>
      </div>
    </div>
  </div>

  <script src="../config.js"></script>
  <script src="../utils/crypto.js"></script>
  <script src="../utils/storage.js"></script>
  <script src="popup-new.js"></script>
</body>
</html>